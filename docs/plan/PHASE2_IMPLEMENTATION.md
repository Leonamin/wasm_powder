# Phase 2 êµ¬í˜„ ì™„ë£Œ (PHASE2_IMPLEMENTATION.md)

**êµ¬í˜„ ë‚ ì§œ:** 2025-11-03

---

## ğŸ“‹ êµ¬í˜„ ë‚´ìš©

### ìˆ˜ëª… ì‹œìŠ¤í…œ (Life System)

FIREì™€ FROST ê°™ì€ ì¼ì‹œì  ë¬¼ì§ˆì´ ìë™ìœ¼ë¡œ ì†Œë©¸ë˜ë„ë¡ ìˆ˜ëª… ì‹œìŠ¤í…œì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

#### êµ¬í˜„ ìœ„ì¹˜
- `src/simulation.cpp` - `updateLifeAndSpecialMaterials()` í•¨ìˆ˜

#### ë™ì‘ ë°©ì‹
```cpp
// Particle êµ¬ì¡°ì²´ì˜ life í•„ë“œ ì‚¬ìš©
// life = -1: ë¬´í•œ (ì¼ë°˜ ë¬¼ì§ˆ)
// life > 0: ë§¤ í”„ë ˆì„ ê°ì†Œ, 0ì´ ë˜ë©´ ì†Œë©¸

if (p.life > 0) {
    p.life--;
    if (p.life == 0) {
        p.type = EMPTY;
        p.state = STATE_GAS;
    }
}
```

#### ë¬¼ì§ˆë³„ ìˆ˜ëª…
- **FIRE**: 30-60 í”„ë ˆì„ (0.5-1ì´ˆ)
- **FROST**: 40-80 í”„ë ˆì„ (0.7-1.3ì´ˆ)
- **ì¼ë°˜ ë¬¼ì§ˆ**: -1 (ë¬´í•œ)

---

## ğŸ”¥ FIRE ê°œì„ 

### ë¬¸ì œì  (ì´ì „)
1. ë¬¼ì§ˆì²˜ëŸ¼ ìŒ“ì—¬ì„œ ì œê±°ë˜ì§€ ì•ŠìŒ
2. ì˜¨ë„ë¥¼ `= 150.0f`ë¡œ ë®ì–´ì¨ì„œ ì—´ ì „ë„ ì°¨ë‹¨
3. ë‹¨ìˆœíˆ ìœ„ë¡œë§Œ ì˜¬ë¼ê°€ì„œ ë¶ˆì²˜ëŸ¼ ë³´ì´ì§€ ì•ŠìŒ

### í•´ê²° ë°©ë²•

#### 1. ì˜¨ë„ ì¦ê°€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
```cpp
// ì´ì „
nextGrid[nIdx].temperature = 150.0f;

// ì´í›„
nextGrid[nIdx].temperature += 30.0f;
if (nextGrid[nIdx].temperature > 200.0f) {
    nextGrid[nIdx].temperature = 200.0f;
}
```

**íš¨ê³¼:**
- âœ… ì—´ ì „ë„ê°€ ì •ìƒ ì‘ë™
- âœ… ë¶ˆì„ ì œê±°í•´ë„ ì—´ì´ ë‚¨ì•„ì„œ ì„œì„œíˆ ì‹ìŒ
- âœ… ì£¼ë³€ ë¬¼ì§ˆì´ ì ì§„ì ìœ¼ë¡œ ê°€ì—´ë¨

#### 2. ë¶ˆ í™•ì‚° ì‹œìŠ¤í…œ
```cpp
// ëœë¤í•˜ê²Œ í™•ì‚° (33% í™•ë¥ )
if (rand() % 3 == 0) {
    int dir = rand() % 4;
    int nx = x + (dir == 0 ? -1 : dir == 1 ? 1 : 0);
    int ny = y + (dir == 2 ? -1 : dir == 3 ? 1 : 0);
    
    if (inBounds(nx, ny)) {
        int nIdx = getIndex(nx, ny);
        // ëœ¨ê±°ìš´ ê³³(80ë„ ì´ìƒ)ì— ë¶ˆ í™•ì‚°
        if (nextGrid[nIdx].type == EMPTY && 
            nextGrid[nIdx].temperature > 80.0f) {
            nextGrid[nIdx].type = FIRE;
            nextGrid[nIdx].state = STATE_GAS;
            nextGrid[nIdx].life = 20 + rand() % 20;
        }
    }
}
```

**íš¨ê³¼:**
- âœ… ë¶ˆì´ ëœ¨ê±°ìš´ ê³³ìœ¼ë¡œ í¼ì§
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ ë¶ˆ íš¨ê³¼
- âœ… ê°€ì—°ì„± ë¬¼ì§ˆ ê°œë… ì¤€ë¹„

#### 3. ëœë¤ ì›€ì§ì„
```cpp
int randomDir = rand() % 3 - 1; // -1, 0, 1

// ìœ„ â†’ ëŒ€ê°ì„  ìœ„ â†’ ì¢Œìš° ìˆœì„œë¡œ ì‹œë„
if (canMoveTo(x, y - 1, mat.density)) {
    // ìœ„ë¡œ ì´ë™
} else if (randomDir != 0 && canMoveTo(x + randomDir, y - 1, mat.density)) {
    // ëŒ€ê°ì„  ìœ„ë¡œ ì´ë™
} else if (canMoveTo(x + randomDir, y, mat.density)) {
    // ì¢Œìš°ë¡œ ì´ë™
}
```

**íš¨ê³¼:**
- âœ… ë¶ˆì´ í”ë“¤ë¦¬ë©° ì˜¬ë¼ê°
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ ë¶ˆê½ƒ ëª¨ì–‘

---

## â„ï¸ FROST ê°œì„ 

### ë¬¸ì œì  (ì´ì „)
1. ë¬¼ì§ˆì²˜ëŸ¼ ìŒ“ì—¬ì„œ ì œê±°ë˜ì§€ ì•ŠìŒ
2. ì˜¨ë„ë¥¼ `= -20.0f`ë¡œ ë®ì–´ì¨ì„œ ì—´ ì „ë„ ì°¨ë‹¨
3. ë‹¨ìˆœíˆ ì•„ë˜ë¡œë§Œ ë–¨ì–´ì§

### í•´ê²° ë°©ë²•

#### 1. ì˜¨ë„ ê°ì†Œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
```cpp
// ì´ì „
nextGrid[nIdx].temperature = -20.0f;

// ì´í›„
nextGrid[nIdx].temperature -= 30.0f;
if (nextGrid[nIdx].temperature < -50.0f) {
    nextGrid[nIdx].temperature = -50.0f;
}
```

**íš¨ê³¼:**
- âœ… ì—´ ì „ë„ê°€ ì •ìƒ ì‘ë™
- âœ… ëƒ‰ê¸°ë¥¼ ì œê±°í•´ë„ ì°¨ê°€ì›€ì´ ë‚¨ì•„ì„œ ì„œì„œíˆ ë°ì›Œì§
- âœ… ì£¼ë³€ ë¬¼ì§ˆì´ ì ì§„ì ìœ¼ë¡œ ëƒ‰ê°ë¨

#### 2. ì´ë™ ë°©ì‹
```cpp
// ì•„ë˜ â†’ ëŒ€ê°ì„  ì•„ë˜ë¡œ ë–¨ì–´ì§
if (canMoveTo(x, y + 1, mat.density)) {
    // ì•„ë˜ë¡œ ì´ë™
} else if (canMoveTo(x - 1, y + 1, mat.density)) {
    // ì™¼ìª½ ì•„ë˜ë¡œ ì´ë™
} else if (canMoveTo(x + 1, y + 1, mat.density)) {
    // ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ ì´ë™
}
```

**íš¨ê³¼:**
- âœ… ì°¨ê°€ìš´ ê³µê¸°ê°€ ì•„ë˜ë¡œ ê°€ë¼ì•‰ìŒ
- âœ… ë°€ë„(1.5 kg/mÂ³) ê¸°ë°˜ ë™ì‘

---

## ğŸ¯ ë‹¤ì¤‘ íŒ¨ìŠ¤ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸

ìƒˆë¡œìš´ íŒ¨ìŠ¤ ì¶”ê°€:

```cpp
void update() {
    // PASS 0: ì¤€ë¹„
    memcpy(nextGrid, grid, sizeof(grid));
    
    // PASS 1: í™”í•™ ë°˜ì‘ (ë¯¸êµ¬í˜„)
    
    // PASS 2: ì—´ ì „ë„
    updateHeatConduction();
    
    // PASS 3: ìƒíƒœ ì „ì´
    updateStateChange();
    
    // PASS 4: í˜ ê³„ì‚°
    updateForces();
    
    // PASS 4.5: ìˆ˜ëª… ë° íŠ¹ìˆ˜ ë¬¼ì§ˆ â­ ì‹ ê·œ
    updateLifeAndSpecialMaterials();
    
    // PASS 5: ì´ë™
    updateMovement();
    
    // FINAL: ê·¸ë¦¬ë“œ êµì²´
    memcpy(grid, nextGrid, sizeof(grid));
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### í…ŒìŠ¤íŠ¸ 1: FIRE ìˆ˜ëª… ë° í™•ì‚°

**ì ˆì°¨:**
1. FIRE ì…ì í•˜ë‚˜ ì¶”ê°€
2. 30-60 í”„ë ˆì„ í›„ ìë™ ì†Œë©¸ í™•ì¸
3. ì˜¨ë„ ëª¨ë“œë¡œ ì „í™˜
4. ì—´ì´ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸
5. ëœ¨ê±°ìš´ ê³³ì— ë¶ˆì´ í™•ì‚°ë˜ëŠ”ì§€ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼:**
- âœ… FIREê°€ 0.5-1ì´ˆ í›„ ì‚¬ë¼ì§
- âœ… ì‚¬ë¼ì§„ ìë¦¬ì— ì—´ì´ ë‚¨ìŒ (ë¹¨ê°„ìƒ‰)
- âœ… ì—´ì´ ì„œì„œíˆ ì‹ìŒ (ë¹¨ê°• â†’ ë…¸ë‘ â†’ ì´ˆë¡)
- âœ… 80ë„ ì´ìƒì¸ ê³³ì— ë¶ˆì´ í¼ì§

### í…ŒìŠ¤íŠ¸ 2: FROST ìˆ˜ëª… ë° ëƒ‰ê°

**ì ˆì°¨:**
1. FROST ì…ì í•˜ë‚˜ ì¶”ê°€
2. 40-80 í”„ë ˆì„ í›„ ìë™ ì†Œë©¸ í™•ì¸
3. ì˜¨ë„ ëª¨ë“œë¡œ ì „í™˜
4. ì°¨ê°€ì›€ì´ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼:**
- âœ… FROSTê°€ 0.7-1.3ì´ˆ í›„ ì‚¬ë¼ì§
- âœ… ì‚¬ë¼ì§„ ìë¦¬ì— ì°¨ê°€ì›€ì´ ë‚¨ìŒ (íŒŒë€ìƒ‰)
- âœ… ì°¨ê°€ì›€ì´ ì„œì„œíˆ ë°ì›Œì§ (íŒŒë‘ â†’ ì´ˆë¡)

### í…ŒìŠ¤íŠ¸ 3: ì—´ ì „ë„ ì •ìƒ ì‘ë™

**ì ˆì°¨:**
1. FIRE ì¶”ê°€
2. ì£¼ë³€ì— SAND ì¶”ê°€
3. ì˜¨ë„ ëª¨ë“œì—ì„œ ê´€ì°°

**ì˜ˆìƒ ê²°ê³¼:**
- âœ… SANDê°€ ì ì§„ì ìœ¼ë¡œ ê°€ì—´ë¨
- âœ… FIREê°€ ì‚¬ë¼ì§„ í›„ì—ë„ SANDëŠ” ëœ¨ê±°ì›€
- âœ… ëœ¨ê±°ìš´ SANDê°€ ì£¼ë³€ìœ¼ë¡œ ì—´ ì „ë‹¬

### í…ŒìŠ¤íŠ¸ 4: ë¶ˆ í™•ì‚°

**ì ˆì°¨:**
1. FIRE ì—¬ëŸ¬ ê°œ ì¶”ê°€
2. ë¶ˆì´ í¼ì§€ëŠ” ëª¨ìŠµ ê´€ì°°

**ì˜ˆìƒ ê²°ê³¼:**
- âœ… ë¶ˆì´ ëœ¨ê±°ìš´ ê³³ìœ¼ë¡œ í™•ì‚°
- âœ… ë¶ˆê½ƒì´ í”ë“¤ë¦¬ë©° ì˜¬ë¼ê°
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ ë¶ˆ íš¨ê³¼

### í…ŒìŠ¤íŠ¸ 5: ì–¼ìŒ ë…¹ì´ê¸° (í†µí•© í…ŒìŠ¤íŠ¸)

**ì ˆì°¨:**
1. ICE ì¶”ê°€
2. FIREë¡œ ê°€ì—´
3. ìƒíƒœ ì „ì´ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼:**
- âœ… ICEê°€ ì ì§„ì ìœ¼ë¡œ ê°€ì—´ë¨ (íŒŒë‘ â†’ ì´ˆë¡)
- âœ… 0ë„ ë„ë‹¬ ì‹œ WATERë¡œ ë³€í•¨
- âœ… WATERê°€ ê³„ì† ê°€ì—´ë¨ (ì´ˆë¡ â†’ ë…¸ë‘)
- âœ… 100ë„ ë„ë‹¬ ì‹œ STEAMìœ¼ë¡œ ë³€í•¨

---

## ğŸ“Š ì„±ëŠ¥ ì˜í–¥

### ì¶”ê°€ëœ ì—°ì‚°
- **PASS 4.5**: ëª¨ë“  ì…€ ìˆœíšŒ (120,000ë²ˆ)
  - ìˆ˜ëª… ê°ì†Œ: O(1)
  - FIRE í™•ì‚°: 33% í™•ë¥ ë¡œ ì£¼ë³€ ì²´í¬
  - FROST ëƒ‰ê°: ì£¼ë³€ 8ì¹¸ ì²´í¬

### ì˜ˆìƒ ì„±ëŠ¥
- ëª©í‘œ: 30-60 FPS ìœ ì§€
- FIRE/FROSTê°€ ë§ì„ ë•Œ ì•½ê°„ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ
- Active Chunks ìµœì í™”ë¡œ ê°œì„  ê°€ëŠ¥

---

## ğŸ‰ ì™„ë£Œëœ ê¸°ëŠ¥

### ìˆ˜ëª… ì‹œìŠ¤í…œ
- âœ… life í•„ë“œ í™œìš©
- âœ… ë§¤ í”„ë ˆì„ ê°ì†Œ
- âœ… 0ì´ ë˜ë©´ ìë™ ì†Œë©¸

### FIRE ê°œì„ 
- âœ… ì˜¨ë„ ì¦ê°€ ë°©ì‹ (ë®ì–´ì“°ê¸° X)
- âœ… ë¶ˆ í™•ì‚° ì‹œìŠ¤í…œ
- âœ… ëœë¤ ì›€ì§ì„
- âœ… ìë™ ì†Œë©¸ (30-60 í”„ë ˆì„)

### FROST ê°œì„ 
- âœ… ì˜¨ë„ ê°ì†Œ ë°©ì‹ (ë®ì–´ì“°ê¸° X)
- âœ… ìë™ ì†Œë©¸ (40-80 í”„ë ˆì„)

### ì—´ ì „ë„ ì •ìƒí™”
- âœ… FIRE/FROST ì œê±° í›„ì—ë„ ì˜¨ë„ ìœ ì§€
- âœ… ì ì§„ì  ì˜¨ë„ ë³€í™”
- âœ… ì „ë„, ëŒ€ë¥˜ ì •ìƒ ì‘ë™

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### Phase 3: ê³ ê¸‰ ë¬¼ë¦¬ ì‹œìŠ¤í…œ
1. **ì ì—´ ì‹œìŠ¤í…œ**
   - `latent_heat_storage` í™œìš©
   - 0ë„ì—ì„œ ì¦‰ì‹œ ë…¹ì§€ ì•ŠëŠ” ì–¼ìŒ
   
2. **ì ë„ ì‹œìŠ¤í…œ**
   - `viscosity` í™œìš©
   - ì•¡ì²´ í¼ì§ ì†ë„ ì¡°ì ˆ

3. **í™”í•™ ë°˜ì‘**
   - ChemistryDB êµ¬ì¶•
   - ë¬¼ì§ˆ ê°„ ìƒí˜¸ì‘ìš©

4. **ê¸°ì•• ì‹œìŠ¤í…œ**
   - `pressure` í•„ë“œ ì¶”ê°€
   - PLAN_PRESSURE.md ì°¸ì¡°

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

### C++ (ë°±ì—”ë“œ)
- `src/simulation.cpp`
  - `updateLifeAndSpecialMaterials()` í•¨ìˆ˜ ì¶”ê°€
  - `updateMovement()` í•¨ìˆ˜ ìˆ˜ì • (FIRE/FROST ì²˜ë¦¬)
  - `addParticle()` í•¨ìˆ˜ ìˆ˜ì • (ìˆ˜ëª… ì„¤ì •)
  - `update()` í•¨ìˆ˜ ìˆ˜ì • (PASS 4.5 ì¶”ê°€)

### ë¬¸ì„œ
- `docs/plan/PLAN_BUG.md` - ë²„ê·¸ í•´ê²° ê¸°ë¡
- `docs/plan/PLAN_BUG_COMPLETED.md` - ë²„ê·¸ #2 ì¶”ê°€
- `docs/plan/PHASE2_IMPLEMENTATION.md` - ì´ ë¬¸ì„œ

---

## ğŸ’¡ ì„¤ê³„ ì² í•™

### ë¬¼ì§ˆ vs ìƒíƒœ ë³€í™”

ì‚¬ìš©ìì˜ ì˜ë„ëŒ€ë¡œ êµ¬ë¶„í–ˆìŠµë‹ˆë‹¤:

**ë¬¼ì§ˆ (Material):**
- SAND, WATER, ICE, STEAM, WALL
- ì˜êµ¬ì ìœ¼ë¡œ ì¡´ì¬
- ë¬¼ë¦¬ì  ì†ì„± ë³´ìœ  (ë°€ë„, ë¹„ì—´ ë“±)

**ìƒíƒœ ë³€í™” ì†ŒìŠ¤ (State Change Source):**
- FIRE (ê°€ì—´), FROST (ëƒ‰ê°)
- ì¼ì‹œì ìœ¼ë¡œ ì¡´ì¬ (ìˆ˜ëª… ìˆìŒ)
- ì˜¨ë„ë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ì—­í• 
- ë¬¼ì§ˆì´ ì•„ë‹Œ "íš¨ê³¼"

### ì˜¨ë„ ì‹œìŠ¤í…œ

**ë®ì–´ì“°ê¸° (X):**
```cpp
temperature = 150.0f; // ì—´ ì „ë„ ì°¨ë‹¨!
```

**ì¦ê°€/ê°ì†Œ (O):**
```cpp
temperature += 30.0f; // ì ì§„ì  ë³€í™”, ì—´ ì „ë„ ì •ìƒ
```

ì´ ë°©ì‹ìœ¼ë¡œ ë°°ê²½(EMPTY)ì„ í†µí•œ ì—´ ì „ë„ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.

---

**Phase 2 êµ¬í˜„ ì™„ë£Œ! ğŸ‰**
